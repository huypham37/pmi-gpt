# ACTIVE MEMORY: Issue #2
## Link
https://github.com/huypham37/pmi-gpt/issues/2

## Context & Goal
Set LM Studio as the default model provider for PMI-Agent. OpenCode handles model configuration — the app just sets `DEFAULT_MODEL` which is the fallback when no user preference is stored.

## How Model/Mode Pipeline Works
1. `DEFAULT_MODEL` defined in `packages/shared/src/config/models.ts` (single source of truth)
2. User preference stored in `~/.craft-agent/config.json` via `getModel()`/`setModel()`
3. On session creation: `resolvedModel = managed.model || config?.model || DEFAULT_MODEL`
4. Passed to OpenCode via `acpSession.setModel(resolvedModel)`
5. Mode: `resolvedMode = getMode() || 'build'` → `acpSession.setMode(resolvedMode)`

## Plan
- [x] Setup branch and environment
- [x] Investigate current default model and mode pipeline
- [x] Change DEFAULT_MODEL from `github-copilot/gpt-5-mini` to `lmstudio/openai/gpt-oss-20b`
- [x] Remove model selector from chat input UI (abstract to Settings only)
- [x] Clean up model prop chain (FreeFormInput → ChatDisplay → ChatPage)
- [x] Clean up playground registry files
- [x] Build and verify
- [ ] Test with LM Studio running locally

## Progress Log
### [2026-02-11] Initialization
- Spawned from issue #2
- Branch `feature/2-set-lm-studio-default` created

### [2026-02-11] Implementation
- Changed `DEFAULT_MODEL` in `packages/shared/src/config/models.ts` to `lmstudio/openai/gpt-oss-20b`
- Removed model selector dropdown from chat input (FreeFormInput.tsx)
- Removed `currentModel`/`onModelChange` props from: FreeFormInput, ChatDisplay, ChatPage
- Removed `handleModelChange`/`effectiveModel`/`setSessionModel` from ChatPage
- Cleaned up EditPopover.tsx (removed unused model state)
- Cleaned up AppShell.tsx (removed unused `currentModel` destructuring)
- Cleaned up playground registry files (input.tsx, chat.tsx, edit-popover.tsx)
- Model selection now only available in Settings page (via AppShellContext)
- Build succeeded

### [2026-02-11] Profile → Mode Mapping
- Added `profileToMode()` in `packages/shared/src/sessions/types.ts`
- Connected profile dropdown to ACP `setMode()` in `apps/electron/src/main/sessions.ts`
- Updated mapping: `testcase` → `'testcase-generator'`, default → `'testcase-generator'`

Current Step: Building after profileToMode update
Next immediate: Build, commit, test with LM Studio
